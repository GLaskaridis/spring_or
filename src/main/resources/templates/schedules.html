<!DOCTYPE html>
<html lang="el" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏÎ½</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
        <style>
            :root {
                --primary-color: #1a365d;
                --secondary-color: #2d3748;
                --accent-color: #4299e1;
                --success-color: #38a169;
                --warning-color: #ed8936;
                --danger-color: #e53e3e;
                --light-bg: #f7fafc;
                --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                --admin-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            body {
                background-color: var(--light-bg);
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .navbar {
                background: var(--admin-gradient);
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            .navbar-brand {
                font-weight: bold;
                font-size: 1.6rem;
            }

            .sidebar {
                min-height: calc(100vh - 76px);
                background: white;
                box-shadow: var(--card-shadow);
                border-radius: 0.75rem;
            }

            .sidebar .nav-link {
                color: var(--secondary-color);
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                margin: 0.25rem;
                transition: all 0.3s ease;
                font-weight: 500;
            }

            .sidebar .nav-link:hover, .sidebar .nav-link.active {
                background: var(--admin-gradient);
                color: white;
                transform: translateX(8px);
            }

            .sidebar .nav-link i {
                width: 20px;
                margin-right: 12px;
            }

            .card {
                border: none;
                border-radius: 1rem;
                box-shadow: var(--card-shadow);
                transition: all 0.3s ease;
                background: white;
            }

            .card-header {
                background: var(--admin-gradient);
                color: white;
                border-radius: 1rem 1rem 0 0 !important;
                border: none;
                font-weight: 600;
            }

            .btn-primary {
                background: var(--admin-gradient);
                border: none;
                border-radius: 0.5rem;
                padding: 0.75rem 1.5rem;
                font-weight: 500;
                transition: all 0.3s ease;
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            }

            .table-container {
                border-radius: 1rem;
                overflow: hidden;
                box-shadow: var(--card-shadow);
            }

            .table thead th {
                background: var(--admin-gradient);
                color: white;
                border: none;
                font-weight: 600;
            }

            .badge-status {
                padding: 0.5rem 1rem;
                border-radius: 2rem;
                font-weight: 500;
            }

            .form-control, .form-select {
                border-radius: 0.5rem;
                border: 2px solid #e2e8f0;
                transition: all 0.3s ease;
            }

            .form-control:focus, .form-select:focus {
                border-color: var(--accent-color);
                box-shadow: 0 0 0 0.2rem rgba(66, 153, 225, 0.25);
            }

            .fade-in {
                animation: fadeIn 0.8s ease-in;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .schedule-stats {
                background: var(--admin-gradient);
                color: white;
                border-radius: 1rem;
                padding: 2rem;
                text-align: center;
                margin-bottom: 2rem;
            }

            .schedule-stats h3 {
                font-size: 2.5rem;
                font-weight: bold;
                margin-bottom: 0.5rem;
            }

            .schedule-stats p {
                opacity: 0.9;
                margin: 0;
            }

            .notification-badge {
                position: absolute;
                top: -8px;
                right: -8px;
                background: var(--danger-color);
                color: white;
                border-radius: 50%;
                width: 24px;
                height: 24px;
                font-size: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
            }

            .phase-indicator {
                display: inline-block;
                width: 12px;
                height: 12px;
                border-radius: 50%;
                margin-right: 8px;
            }

            .phase-assignment {
                background-color: #3b82f6;
            }
            .phase-requirements {
                background-color: #f59e0b;
            }
            .phase-execution {
                background-color: #8b5cf6;
            }
            .phase-solution {
                background-color: #10b981;
            }
            .phase-approved {
                background-color: #059669;
            }
            .phase-no-solution {
                background-color: #ef4444;
            }
            .phase-completed {
                background-color: #6b7280;
            }
            .phase-terminated {
                background-color: #374151;
            }

            @media (max-width: 768px) {
                .sidebar {
                    margin-bottom: 2rem;
                }
            }
        </style>
    </head>
    <body>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-shield-alt me-2"></i>
                    Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/dashboard">
                                <i class="fas fa-home me-1"></i>
                                Î‘ÏÏ‡Î¹ÎºÎ®
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle position-relative" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge">2</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><h6 class="dropdown-header">Î•Î¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚</h6></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-calendar text-success me-2"></i>ÎÎ­Î¿Ï‚ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-exclamation-triangle text-warning me-2"></i>Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-shield me-1"></i>
                                Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Î ÏÎ¿Ï†Î¯Î»</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cogs me-2"></i>Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/users/logout"><i class="fas fa-sign-out-alt me-2"></i>Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid mt-4">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-lg-3 col-md-4 mb-4">
                    <div class="sidebar p-3 fade-in">
                        <nav class="nav flex-column">
                            <a class="nav-link" href="/admin/dashboard">
                                <i class="fas fa-tachometer-alt"></i>
                                Î•Ï€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·
                            </a>
                            <a class="nav-link" href="/teachers/list">
                                <i class="fas fa-users"></i>
                                Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î§ÏÎ·ÏƒÏ„ÏÎ½
                            </a>
                            <a class="nav-link" href="/courses/list">
                                <i class="fas fa-book"></i>
                                Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½
                            </a>
                            <a class="nav-link" href="/rooms/list">
                                <i class="fas fa-door-open"></i>
                                Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î‘Î¹Î¸Î¿Ï…ÏƒÏÎ½
                            </a>
                            <a class="nav-link active" href="/admin/schedules">
                                <i class="fas fa-calendar-alt"></i>
                                Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚
                            </a>
                            <a class="nav-link" href="/admin/assignments">
                                <i class="fas fa-tasks"></i>
                                Î‘Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚ ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½
                            </a>
                            <a class="nav-link" href="#reports">
                                <i class="fas fa-chart-bar"></i>
                                Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚ & Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬
                            </a>
                            <a class="nav-link" href="#system-settings">
                                <i class="fas fa-cogs"></i>
                                Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚
                            </a>
                        </nav>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-lg-9 col-md-8">
                    <!-- Page Header -->
                    <div class="d-flex justify-content-between align-items-center mb-4 fade-in">
                        <div>
                            <h1 class="h3 mb-0">Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏÎ½</h1>
                            <p class="text-muted">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏÎ½ ÎµÎ¾Î±Î¼Î®Î½Î¿Ï…</p>
                        </div>
                        <button class="btn btn-primary" id="addScheduleBtn" data-bs-toggle="modal" data-bs-target="#scheduleModal">
                            <i class="fas fa-plus me-2"></i>
                            ÎÎ­Î¿Ï‚ Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚
                        </button>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="row mb-4 fade-in">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="schedule-stats">
                                <h3 id="totalSchedules">0</h3>
                                <p>Î£Ï…Î½Î¿Î»Î¹ÎºÎ¿Î¯ Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Î¯</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="schedule-stats" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <h3 id="activeSchedules">0</h3>
                                <p>Î•Î½ÎµÏÎ³Î¿Î¯</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="schedule-stats" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <h3 id="inProgressSchedules">0</h3>
                                <p>Î£Îµ Î•Î¾Î­Î»Î¹Î¾Î·</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="schedule-stats" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <h3 id="completedSchedules">0</h3>
                                <p>ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î¿Î¹</p>
                            </div>
                        </div>
                    </div>

                    <!-- Alerts Container -->
                    <div id="schedules-alert" class="mb-4"></div>

                    <!-- Schedules Table -->
                    <div class="card fade-in">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-list me-2"></i>
                                Î›Î¯ÏƒÏ„Î± Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏÎ½
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table id="schedulesTable" class="table table-hover w-100">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>ÎŒÎ½Î¿Î¼Î±</th>
                                            <th>Î•Î¾Î¬Î¼Î·Î½Î¿</th>
                                            <th>ÎˆÏ„Î¿Ï‚</th>
                                            <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
                                            <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚</th>
                                            <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Î”Ï…Î½Î±Î¼Î¹ÎºÏŒ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schedule Modal -->
        <div class="modal fade" id="scheduleModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header" style="background: var(--admin-gradient); color: white;">
                        <h5 class="modal-title" id="scheduleModalTitle">
                            <i class="fas fa-calendar-plus me-2"></i>
                            ÎÎ­Î¿Ï‚ Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="scheduleForm">
                            <input type="hidden" id="scheduleId" name="id">

                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="scheduleName" class="form-label">ÎŒÎ½Î¿Î¼Î± Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="scheduleName" name="name" required
                                           placeholder="Ï€.Ï‡. Î§ÎµÎ¹Î¼ÎµÏÎ¹Î½ÏŒ Î•Î¾Î¬Î¼Î·Î½Î¿ 2024-25">
                                    <div class="form-text">Î”ÏÏƒÏ„Îµ Î­Î½Î± Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î¹ÎºÏŒ ÏŒÎ½Î¿Î¼Î± Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ</div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="scheduleSemester" class="form-label">Î•Î¾Î¬Î¼Î·Î½Î¿ <span class="text-danger">*</span></label>
                                    <select class="form-select" id="scheduleSemester" name="semester" required>
                                        <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎµÎ¾Î¬Î¼Î·Î½Î¿...</option>
                                        <option value="Î§ÎµÎ¹Î¼ÎµÏÎ¹Î½ÏŒ">Î§ÎµÎ¹Î¼ÎµÏÎ¹Î½ÏŒ</option>
                                        <option value="Î•Î±ÏÎ¹Î½ÏŒ">Î•Î±ÏÎ¹Î½ÏŒ</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="scheduleYear" class="form-label">Î‘ÎºÎ±Î´Î·Î¼Î±ÏŠÎºÏŒ ÎˆÏ„Î¿Ï‚ <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="scheduleYear" name="year" 
                                           min="2024" max="2030" required
                                           placeholder="Ï€.Ï‡. 2024">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="scheduleDescription" class="form-label">Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label>
                                <textarea class="form-control" id="scheduleDescription" name="description" rows="3"
                                          placeholder="Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ® Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Ï„Î¿Ï… Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï..."></textarea>
                            </div>

                            <!-- Advanced Settings -->
                            <div class="card border-0 bg-light">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="mb-0">
                                        <i class="fas fa-cogs me-2"></i>
                                        Î ÏÎ¿Î·Î³Î¼Î­Î½ÎµÏ‚ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="scheduleStartTime" class="form-label">ÎÏÎ± ÎˆÎ½Î±ÏÎ¾Î·Ï‚ ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½</label>
                                            <input type="time" class="form-control" id="scheduleStartTime" name="startTime" value="08:00">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="scheduleEndTime" class="form-label">ÎÏÎ± Î›Î®Î¾Î·Ï‚ ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½</label>
                                            <input type="time" class="form-control" id="scheduleEndTime" name="endTime" value="21:00">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="maxHoursPerDay" class="form-label">ÎœÎ­Î³Î¹ÏƒÏ„ÎµÏ‚ ÎÏÎµÏ‚ Î±Î½Î¬ Î—Î¼Î­ÏÎ±</label>
                                            <input type="number" class="form-control" id="maxHoursPerDay" name="maxHoursPerDay" min="1" max="12" value="9">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="maxDistanceKm" class="form-label">ÎœÎ­Î³Î¹ÏƒÏ„Î· Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· Î‘Î¹Î¸Î¿Ï…ÏƒÏÎ½ (km)</label>
                                            <input type="number" class="form-control" id="maxDistanceKm" name="maxDistanceKm" min="0" max="10" step="0.1" value="1.0">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="scheduleActive" name="active" checked>
                                                <label class="form-check-label" for="scheduleActive">
                                                    Î•Î½ÎµÏÎ³ÏŒÏ‚ Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong> ÎœÎµÏ„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±, Î¿ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î· Ï†Î¬ÏƒÎ· 
                                "Î‘Î½Î¬Î¸ÎµÏƒÎ· ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½" ÎºÎ±Î¹ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Î±Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚ Î¼Î±Î¸Î·Î¼Î¬Ï„Ï‰Î½.
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>
                            Î‘ÎºÏÏÏ‰ÏƒÎ·
                        </button>
                        <button type="button" class="btn btn-primary" onclick="saveSchedule()">
                            <i class="fas fa-save me-1"></i>
                            Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteScheduleModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· Î”Î¹Î±Î³ÏÎ±Ï†Î®Ï‚
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Î•Î¯ÏƒÏ„Îµ Î²Î­Î²Î±Î¹Î¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿Î½ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ;</p>
                        <div id="deleteScheduleDetails" class="alert alert-warning"></div>
                        <div class="alert alert-danger">
                            <strong>Î ÏÎ¿ÏƒÎ¿Ï‡Î®:</strong> Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î¸Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚:
                            <ul class="mb-0 mt-2">
                                <li>ÎŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚ Î¼Î±Î¸Î·Î¼Î¬Ï„Ï‰Î½</li>
                                <li>ÎŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ Î´Î¹Î´Î±ÏƒÎºÏŒÎ½Ï„Ï‰Î½</li>
                                <li>Î¤Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï</li>
                            </ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteScheduleBtn">
                            <i class="fas fa-trash me-1"></i>
                            Î”Î¹Î±Î³ÏÎ±Ï†Î®
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Change Modal -->
        <div class="modal fade" id="statusChangeModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header" style="background: var(--admin-gradient); color: white;">
                        <h5 class="modal-title">
                            <i class="fas fa-exchange-alt me-2"></i>
                            Î‘Î»Î»Î±Î³Î® ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î· Î½Î­Î± ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ:</p>
                            
                        <input type="hidden" id="statusScheduleId">
                        
                        <div class="mb-3">
                            <label class="form-label">Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚</label>
                            <div class="alert alert-secondary">
                                <strong id="statusScheduleName"></strong>
                            </div>
                        </div>

                        <!-- Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ±Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ -->
                        <div class="mb-3">
                            <label class="form-label">Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</label>
                            <div class="alert alert-info">
                                <span id="currentStatus"></span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="newStatus" class="form-label">ÎÎ­Î± ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</label>
                            <select class="form-select" id="newStatus">
                                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·...</option>
                                <option value="ASSIGNMENT_PHASE">Î¦Î¬ÏƒÎ· Î‘Î½Î¬Î¸ÎµÏƒÎ·Ï‚ ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½</option>
                                <option value="REQUIREMENTS_PHASE">Î¦Î¬ÏƒÎ· Î Î±ÏÎ¿Ï‡Î®Ï‚ Î‘Ï€Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½</option>
                                <option value="EXECUTION_PHASE">Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î‘Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï…</option> <!-- Î”Î™ÎŸÎ¡Î˜Î©Î£Î— -->
                                <option value="SOLUTION_FOUND">Î›ÏÏƒÎ· Î’ÏÎ­Î¸Î·ÎºÎµ</option>
                                <option value="SOLUTION_APPROVED">Î›ÏÏƒÎ· Î•Î³ÎºÏÎ¯Î¸Î·ÎºÎµ</option>
                                <option value="TERMINATED">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ</option>
                            </select>
                        </div>

                        <div class="alert alert-info">
                            <strong>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong> Î— Î±Î»Î»Î±Î³Î® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î·ÏÎµÎ¬ÏƒÎµÎ¹ Ï„Î¹Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ 
                            Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
                        <button type="button" class="btn btn-primary" onclick="changeScheduleStatus()">
                            <i class="fas fa-check me-1"></i>
                            Î‘Î»Î»Î±Î³Î® ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

       <script>
    let schedulesTable;
    let currentScheduleId = null;

    // Initialize DataTable
    $(document).ready(function () {
        schedulesTable = $('#schedulesTable').DataTable({
            responsive: true,
            pageLength: 10,
            processing: true,
            ajax: {
                url: '/admin/api/schedules',
                type: 'GET',
                dataSrc: function (json) {
                    updateStatistics(json);
                    return json;
                }
            },
            columns: [
                {data: 'name'},
                {data: 'semester'},
                {data: 'year'},
                {
                    data: 'status',
                    render: function (data, type, row) {
                        return getStatusBadge(data);
                    }
                },
                {
                    data: 'active',
                    render: function (data, type, row) {
                        return data ? '<span class="badge bg-success">Î•Î½ÎµÏÎ³ÏŒ</span>' : '<span class="badge bg-secondary">Î‘Î½ÎµÎ½ÎµÏÎ³ÏŒ</span>';
                    }
                },
                {
                    data: 'createdDate',  // Change from 'createdAt' to 'createdDate'
                    render: function(data, type, row) {
                        if (data) {
                            return new Date(data).toLocaleDateString('el-GR');
                        }
                        return new Date().toLocaleDateString('el-GR');
                    }
                },
                {
                    data: null,
                    orderable: false,
                    render: function (data, type, row) {
                        // Conditional buttons based on status
                        let executeButton = '';
                        if (row.status === 'EXECUTION_PHASE') {
                            executeButton = `<button class="btn btn-sm btn-warning me-1" onclick="executeSchedule(${row.id})" title="Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î‘Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï…">
                                <i class="fas fa-play"></i>
                            </button>`;
                        }
                        
                        let resultsButton = '';
                        if (row.status === 'SOLUTION_FOUND' || row.status === 'SOLUTION_APPROVED') {
                            resultsButton = `<button class="btn btn-sm btn-success me-1" onclick="viewResults(${row.id})" title="Î ÏÎ¿Î²Î¿Î»Î® Î‘Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½">
                                <i class="fas fa-chart-bar"></i>
                            </button>`;
                        }

                        return `<div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" onclick="viewSchedule(${row.id})" title="Î ÏÎ¿Î²Î¿Î»Î®">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editSchedule(${row.id})" title="Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-info" onclick="changeStatus(${row.id})" title="Î‘Î»Î»Î±Î³Î® ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            ${executeButton}
                            ${resultsButton}
                            <button class="btn btn-sm btn-danger" onclick="deleteSchedule(${row.id})" title="Î”Î¹Î±Î³ÏÎ±Ï†Î®">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>`;
                    }
                }
            ],
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.13.7/i18n/el.json'
            }
        });

        // Load schedules on page load
        ///loadSchedules();
    });

    // Save schedule (create or update)
    function saveSchedule() {
        const form = document.getElementById('scheduleForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const formData = new FormData(form);
        const isNewSchedule = !currentScheduleId;

        const scheduleData = {
            name: formData.get('name'),
            semester: formData.get('semester'),
            year: parseInt(formData.get('year'))
        };

        const url = isNewSchedule ? '/admin/api/schedules' : `/admin/api/schedules/${currentScheduleId}`;
        const method = isNewSchedule ? 'POST' : 'PUT';

        console.log('Making request to:', url, 'with method:', method);

        // Show loading state
        const submitBtn = document.querySelector('#scheduleModal button[onclick="saveSchedule()"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...';
        submitBtn.disabled = true;

        fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(scheduleData)
        })
        .then(response => {
            console.log('Response status:', response.status);
            return response.text().then(text => {
                try {
                    return JSON.parse(text);
                } catch (e) {
                    console.error('Failed to parse JSON:', text);
                    throw new Error('Server returned invalid JSON: ' + text);
                }
            });
        })
        .then(data => {
            console.log('Response data:', data);
            if (data.success) {
                showAlert('schedules-alert', data.message, 'success');

                // Close modal and reload table
                bootstrap.Modal.getInstance(document.getElementById('scheduleModal')).hide();

                if (typeof schedulesTable !== 'undefined') {
                    schedulesTable.ajax.reload();
                }
            } else {
                showAlert('schedules-alert', data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±', 'danger');
            }
        })
        .catch(error => {
            console.error('Fetch error:', error);
            showAlert('schedules-alert', 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·: ' + error.message, 'danger');
        })
        .finally(() => {
            // Restore button state
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        });
    }

    // View schedule details
    function viewSchedule(id) {
        window.location.href = `/admin/assignments?scheduleId=${id}`;
    }

    // Edit schedule
    function editSchedule(id) {
        currentScheduleId = id;

        // Get schedule data from the table
        const row = schedulesTable.rows().data().toArray().find(r => r.id === id);

        if (row) {
            $('#scheduleId').val(id);
            $('#scheduleName').val(row.name);
            $('#scheduleSemester').val(row.semester);
            $('#scheduleYear').val(row.year);

            // Update modal title
            $('#scheduleModalLabel').text('Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï');

            // Show modal
            new bootstrap.Modal(document.getElementById('scheduleModal')).show();
        }
    }

    // Create new schedule
    function createSchedule() {
        currentScheduleId = null;

        // Reset form
        document.getElementById('scheduleForm').reset();

        // Update modal title
        $('#scheduleModalLabel').text('ÎÎ­Î¿Ï‚ Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚');

        // Show modal
        new bootstrap.Modal(document.getElementById('scheduleModal')).show();
    }

    // Change schedule status
    function changeStatus(id) {
        currentScheduleId = id;

        // Get current schedule data
        const row = schedulesTable.rows().data().toArray().find(r => r.id === id);

        if (row) {
            $('#statusScheduleId').val(id);
            $('#statusScheduleName').text(row.name);
            $('#currentStatus').text(getStatusText(row.status));
            $('#newStatus').val('');

            // Show status change modal
            new bootstrap.Modal(document.getElementById('statusChangeModal')).show();
        }
    }

    function executeSchedule(scheduleId) {
    console.log('executeSchedule called with ID:', scheduleId);
    
    if (confirm('Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¿Î½ Î±Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡ÏÎ¿Î½Î¿Î´Î¹Î¬Î³ÏÎ±Î¼Î¼Î±;')) {
        
        // First, check the schedule status
        console.log('Checking schedule status...');
        fetch(`/schedule-execution/debug-status/${scheduleId}`)
        .then(response => response.json())
        .then(data => {
            console.log('Schedule status:', data);
            
            if (!data.readyForExecution) {
                showAlert('schedules-alert', 
                    `Î¤Î¿ Ï‡ÏÎ¿Î½Î¿Î´Î¹Î¬Î³ÏÎ±Î¼Î¼Î± Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Ï„Î¿Î¹Î¼Î¿ Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·. Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: ${data.currentStatus}. ` +
                    `Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: EXECUTION_PHASE`, 
                    'warning');
                return;
            }
            
            if (data.assignmentsCount === 0) {
                showAlert('schedules-alert', 'Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚ Î¼Î±Î¸Î·Î¼Î¬Ï„Ï‰Î½. Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î±Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚ Ï€ÏÏÏ„Î±.', 'warning');
                return;
            }
            
            if (data.roomsCount === 0) {
                showAlert('schedules-alert', 'Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î±Î¯Î¸Î¿Ï…ÏƒÎµÏ‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î±Î¯Î¸Î¿Ï…ÏƒÎµÏ‚ Ï€ÏÏÏ„Î±.', 'warning');
                return;
            }
            
            // Status is OK, proceed with execution
            console.log('Status check passed, executing algorithm...');
            executeAlgorithm(scheduleId);
        })
        .catch(error => {
            console.error('Error checking status:', error);
            showAlert('schedules-alert', 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚: ' + error.message, 'danger');
        });
    }
}


    // View algorithm results
    function viewResults(scheduleId) {
        window.location.href = `/schedule-execution/results/${scheduleId}`;
    }

    // Change schedule status function
    function changeScheduleStatus() {
        const scheduleId = $('#statusScheduleId').val();
        const newStatus = $('#newStatus').val();

        if (!newStatus) {
            showAlert('schedules-alert', 'Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î½Î­Î± ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·', 'warning');
            return;
        }

        fetch(`/admin/api/schedules/${scheduleId}/status`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                status: newStatus
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showAlert('schedules-alert', data.message, 'success');

                // Close modal and reload table
                bootstrap.Modal.getInstance(document.getElementById('statusChangeModal')).hide();
                schedulesTable.ajax.reload();
            } else {
                showAlert('schedules-alert', data.message, 'danger');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert('schedules-alert', 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î»Î»Î±Î³Î® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚', 'danger');
        });
    }

    // Delete schedule
    function deleteSchedule(id) {
        currentScheduleId = id;

        // Get schedule data for confirmation
        const row = schedulesTable.rows().data().toArray().find(r => r.id === id);

        if (row) {
            $('#deleteScheduleDetails').html(`
                <strong>ÎŒÎ½Î¿Î¼Î±:</strong> ${row.name}<br>
                <strong>Î•Î¾Î¬Î¼Î·Î½Î¿:</strong> ${row.semester}<br>
                <strong>ÎˆÏ„Î¿Ï‚:</strong> ${row.year}<br>
                <strong>Î‘Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚:</strong> ${row.assignmentCount || 0}
            `);

            new bootstrap.Modal(document.getElementById('deleteScheduleModal')).show();
        }
    }


    $('#confirmDeleteScheduleBtn').click(function () {
        if (currentScheduleId) {
            fetch(`/admin/api/schedules/${currentScheduleId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('schedules-alert', data.message, 'success');

                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('deleteScheduleModal')).hide();

                    // Reload table
                    schedulesTable.ajax.reload();
                } else {
                    showAlert('schedules-alert', data.message, 'danger');
                }

                currentScheduleId = null;
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('schedules-alert', 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î®', 'danger');
                currentScheduleId = null;
            });
        }
    });
    
    function showAlert(elementId, message, type, persistent = false) {
        const alertContainer = document.getElementById(elementId);

        // Choose icon based on type
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        else if (type === 'danger' || type === 'error') icon = 'exclamation-triangle';
        else if (type === 'warning') icon = 'exclamation-circle';

        // Create alert with better formatting for multi-line messages
        const formattedMessage = message.replace(/\n/g, '<br>');

        const alertHtml = `
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                <i class="fas fa-${icon} me-2"></i>
                <div>${formattedMessage}</div>
                ${!persistent ? '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>' : ''}
            </div>
        `;

        alertContainer.innerHTML = alertHtml;

        // Auto-hide success messages after 5 seconds
        if (type === 'success' && !persistent) {
            setTimeout(() => {
                const alert = alertContainer.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }
    }


    function executeSchedule(scheduleId) {
        console.log('executeSchedule called with ID:', scheduleId);

        if (confirm('Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¿Î½ Î±Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡ÏÎ¿Î½Î¿Î´Î¹Î¬Î³ÏÎ±Î¼Î¼Î±;')) {

            // Show loading message
            showAlert('schedules-alert', 
                'ğŸ”„ Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î±Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï… ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·...<br><small>Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±ÏÎºÎ­ÏƒÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ¬ Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±</small>', 
                'info', true);

            // Disable the execute button
            const executeBtn = document.querySelector(`[onclick="executeSchedule(${scheduleId})"]`);
            if (executeBtn) {
                executeBtn.disabled = true;
                executeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Î•ÎºÏ„Î­Î»ÎµÏƒÎ·...';
            }

            // Add timeout protection
            const timeoutId = setTimeout(() => {
                showAlert('schedules-alert', 
                    'â±ï¸ Î— ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î´Î¹Î±ÏÎºÎµÎ¯ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿ Î±Ï€ÏŒ Ï„Î¿ Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î¿...<br>' +
                    '<small>Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ Î® Î±Î½Î±Î½ÎµÏÏƒÏ„Îµ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ·</small>', 
                    'warning');
            }, 10000); // 10 seconds warning

            window.location.href = `/schedule-execution/execute/${scheduleId}`;
       

            // Execute the algorithm
//            fetch(`/schedule-execution/execute/${scheduleId}`, {
//                method: 'GET',
//                credentials: 'same-origin'
//            })
//            .then(response => {
//                clearTimeout(timeoutId);
//
//                if (response.redirected) {
//                    // Check if redirected to results or back to schedules
//                    if (response.url.includes('schedule-execution-result')) {
//                        // Success - go to results
//                        window.location.href = response.url;
//                    } else {
//                        // Redirected back to schedules (probably with error)
//                        window.location.href = response.url;
//                    }
//                } else if (response.ok) {
//                    // Direct success response
//                    return response.text().then(html => {
//                        if (html.includes('schedule-execution-result')) {
//                            // Results page returned
//                            document.open();
//                            document.write(html);
//                            document.close();
//                        } else {
//                            throw new Error('Unexpected response format');
//                        }
//                    });
//                } else {
//                    throw new Error(`Server error: ${response.status}`);
//                }
//            })
//            .catch(error => {
//                clearTimeout(timeoutId);
//                console.error('Error executing algorithm:', error);
//
//                showAlert('schedules-alert', 
//                    'âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î¿Ï… Î±Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï…:<br>' +
//                    `<small>${error.message}</small><br><br>` +
//                    'ğŸ’¡ Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ Î® ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®.', 
//                    'danger');
//
//                // Re-enable the button
//                if (executeBtn) {
//                    executeBtn.disabled = false;
//                    executeBtn.innerHTML = '<i class="fas fa-play"></i> Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î‘Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï…';
//                }
//            });
        }
    }

    // Function to handle no-solution scenarios
    function handleNoSolutionError(scheduleId, scheduleName) {
        const errorModal = `
            <div class="modal fade" id="noSolutionModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-warning text-dark">
                            <h5 class="modal-title">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Î”ÎµÎ½ Î’ÏÎ­Î¸Î·ÎºÎµ Î›ÏÏƒÎ· Î§ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <h6>Î§ÏÎ¿Î½Î¿Î´Î¹Î¬Î³ÏÎ±Î¼Î¼Î±: ${scheduleName}</h6>

                            <div class="alert alert-info">
                                <h6><i class="fas fa-info-circle me-2"></i>Î¤Î¹ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Î±Ï…Ï„ÏŒ;</h6>
                                <p>ÎŸ Î±Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿Ï‚ Î´ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎµ Î½Î± Î²ÏÎµÎ¹ Î­Î½Î±Î½ Î­Î³ÎºÏ…ÏÎ¿ Ï‡ÏÎ¿Î½Î¿Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ Ï€Î¿Ï… Î½Î± Î¹ÎºÎ±Î½Î¿Ï€Î¿Î¹ÎµÎ¯ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ ÎºÎ±Î¹ Ï„Î¹Ï‚ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚.</p>
                            </div>

                            <div class="alert alert-warning">
                                <h6><i class="fas fa-search me-2"></i>Î Î¹Î¸Î±Î½Î­Ï‚ Î‘Î¹Ï„Î¯ÎµÏ‚:</h6>
                                <ul class="mb-0">
                                    <li>Î Î¿Î»Ï Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÏ„Î¹ÎºÎ­Ï‚ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¸Î·Î³Î·Ï„ÏÎ½</li>
                                    <li>Î‘Î½ÎµÏ€Î±ÏÎºÎµÎ¯Ï‚ Î±Î¯Î¸Î¿Ï…ÏƒÎµÏ‚ Î³Î¹Î± Ï„Î± Î¼Î±Î¸Î®Î¼Î±Ï„Î±</li>
                                    <li>Î£Ï…Î³ÎºÏÎ¿ÏÏƒÎµÎ¹Ï‚ ÏƒÏ„Î± Ï‡ÏÎ¿Î½Î¹ÎºÎ¬ Î´Î¹Î±ÏƒÏ„Î®Î¼Î±Ï„Î±</li>
                                    <li>Î¥Ï€ÎµÏÎ²Î¿Î»Î¹ÎºÏŒÏ‚ Ï†ÏŒÏÏ„Î¿Ï‚ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ ÏƒÎµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î¼Î­ÏÎµÏ‚</li>
                                </ul>
                            </div>

                            <div class="alert alert-success">
                                <h6><i class="fas fa-lightbulb me-2"></i>Î ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½ÎµÏ‚ Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚:</h6>
                                <ul class="mb-0">
                                    <li>Î•Î»Î­Î³Î¾Ï„Îµ ÎºÎ±Î¹ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ Ï„Ï‰Î½ ÎºÎ±Î¸Î·Î³Î·Ï„ÏÎ½</li>
                                    <li>Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±ÏÎºÎµÏ„Î­Ï‚ Î±Î¯Î¸Î¿Ï…ÏƒÎµÏ‚</li>
                                    <li>ÎœÎµÎ¹ÏÏƒÏ„Îµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Ï‰Î½ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÏ„Î¹ÎºÏÎ½ Ï€ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÏ‰Î½</li>
                                    <li>Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¼Îµ Ï€Î¹Î¿ ÎµÏ…Î­Î»Î¹ÎºÏ„ÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</li>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
                            <button type="button" class="btn btn-primary" onclick="goToPreferences(${scheduleId})">
                                <i class="fas fa-cog me-2"></i>Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÏ‰Î½
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Add modal to page and show it
        document.body.insertAdjacentHTML('beforeend', errorModal);
        const modal = new bootstrap.Modal(document.getElementById('noSolutionModal'));
        modal.show();

        // Remove modal when hidden
        document.getElementById('noSolutionModal').addEventListener('hidden.bs.modal', function() {
            this.remove();
        });
    }

    // Helper function to navigate to preferences page
    function goToPreferences(scheduleId) {
        window.location.href = `/program-manager/preferences/${scheduleId}`;
    }

    // Check for flash messages when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Check if there are flash attributes for no solution
        const urlParams = new URLSearchParams(window.location.search);
        const errorType = urlParams.get('errorType');

        if (errorType === 'NO_SOLUTION') {
            const scheduleId = urlParams.get('scheduleId');
            const scheduleName = urlParams.get('scheduleName');

            if (scheduleId && scheduleName) {
                setTimeout(() => {
                    handleNoSolutionError(scheduleId, scheduleName);
                }, 500);
            }
        }
    });
    
    function executeAlgorithmWithFetch(scheduleId) {
        showAlert('schedules-alert', 'Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î±Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï… ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·...', 'info');

           fetch(`/schedule-execution/execute/${scheduleId}`, {
            method: 'GET',
            credentials: 'same-origin'
        })
        .then(response => {
            console.log('Response status:', response.status);
            console.log('Response headers:', response.headers);

            if (response.redirected) {
                console.log('Redirected to:', response.url);
                window.location.href = response.url;
            } else {
                return response.text().then(text => {
                    console.log('Response body:', text);
                    // If we get HTML back, it might be the results page
                    if (text.includes('schedule-execution-result') || text.includes('Ãâ€¢Ãâ‚¬ÃÂ¹Ãâ€Ãâ€¦Ãâ€¡ÃÂ®Ãâ€š Ãâ€¢ÃÂºÃâ€ÃÂ­ÃÂ»ÃÂµÃÆ’ÃÂ·')) {
                        // Parse the response and show results
                        document.open();
                        document.write(text);
                        document.close();
                    } else {
                        throw new Error('Unexpected response from server');
                    }
                });
            }
        })
        .catch(error => {
            console.error('Error executing algorithm:', error);
            showAlert('schedules-alert', 'ÃÂ£Ãâ€ ÃÂ¬ÃÂ»ÃÂ¼ÃÂ± ÃÂºÃÂ±Ãâ€ÃÂ¬ Ãâ€ÃÂ·ÃÂ½ ÃÂµÃÂºÃâ€ÃÂ­ÃÂ»ÃÂµÃÆ’ÃÂ· Ãâ€ÃÂ¿Ãâ€¦ ÃÂ±ÃÂ»ÃÂ³ÃÂ¿ÃÂÃÂ¯ÃÂ¸ÃÂ¼ÃÂ¿Ãâ€¦: ' + error.message, 'danger');

            // Re-enable the button
            const executeBtn = document.querySelector(`[onclick="executeSchedule(${scheduleId})"]`);
            if (executeBtn) {
                executeBtn.disabled = false;
                executeBtn.innerHTML = '<i class="fas fa-play"></i> Ãâ€¢ÃÂºÃâ€ÃÂ­ÃÂ»ÃÂµÃÆ’ÃÂ· Ãâ€˜ÃÂ»ÃÂ³ÃÂ¿ÃÂÃÂ¯ÃÂ¸ÃÂ¼ÃÂ¿Ãâ€¦';
            }
        });
    }


     function checkScheduleStatus(scheduleId) {
            fetch(`/schedule-execution/debug-status/${scheduleId}`)
            .then(response => response.json())
            .then(data => {
                console.log('Schedule Status Debug:', data);
                alert(`Schedule: ${data.scheduleName}
        Status: ${data.currentStatus}
        Assignments: ${data.assignmentsCount}
        Preferences: ${data.preferencesCount}
        Rooms: ${data.roomsCount}
        Ready for Execution: ${data.readyForExecution}`);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error checking status: ' + error.message);
            });
    }
    
    function executeAlgorithm(scheduleId) {
        showAlert('schedules-alert', 'Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î±Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï… ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·...', 'info');

        // Disable the execute button to prevent multiple clicks
        const executeBtn = document.querySelector(`[onclick="executeSchedule(${scheduleId})"]`);
        if (executeBtn) {
            executeBtn.disabled = true;
            executeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ãâ€¢ÃÂºÃâ€ÃÂ­ÃÂ»ÃÂµÃÆ’ÃÂ·...';
        }

        console.log('Making request to execute endpoint...');

        // Execute the algorithm
        window.location.href = `/schedule-execution/execute/${scheduleId}`;
   }

    // Update statistics
     function updateStatistics(data) {
        const total = data.length;
        const active = data.filter(s => s.active !== false).length;
        const inProgress = data.filter(s =>
            s.status === 'ASSIGNMENT_PHASE' ||
            s.status === 'REQUIREMENTS_PHASE' ||
            s.status === 'EXECUTION_PHASE'
        ).length;
        const completed = data.filter(s =>
            s.status === 'SOLUTION_APPROVED'
        ).length;

        $('#totalSchedules').text(total);
        $('#activeSchedules').text(active);
        $('#inProgressSchedules').text(inProgress);
        $('#completedSchedules').text(completed);
    }

    // Get status badge HTML
     function getStatusBadge(status) {
        const statusConfig = {
            'ASSIGNMENT_PHASE': {class: 'bg-primary', text: 'Î‘Î½Î¬Î¸ÎµÏƒÎ· ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½', icon: 'phase-assignment'},
            'REQUIREMENTS_PHASE': {class: 'bg-warning', text: 'Î Î±ÏÎ¿Ï‡Î® Î ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÏ‰Î½', icon: 'phase-requirements'},
            'EXECUTION_PHASE': {class: 'bg-info', text: 'Î•ÎºÏ„Î­Î»ÎµÏƒÎ·', icon: 'phase-execution'},
            'SOLUTION_FOUND': {class: 'bg-success', text: 'Î•ÏÏÎµÏƒÎ· Î›ÏÏƒÎ·Ï‚', icon: 'phase-solution'},
            'NO_SOLUTION_FOUND': {class: 'bg-danger', text: 'ÎœÎ· Î•ÏÏÎµÏƒÎ· Î›ÏÏƒÎ·Ï‚', icon: 'phase-no-solution'},
            'SOLUTION_APPROVED': {class: 'bg-success', text: 'ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î›ÏÏƒÎ·Ï‚', icon: 'phase-approved'},
            'TERMINATED': {class: 'bg-dark', text: 'Î›Î®Î¾Î·', icon: 'phase-terminated'}
        };

        const config = statusConfig[status] || {class: 'bg-secondary', text: status, icon: 'phase-completed'};
        return `<span class="badge ${config.class}">${config.text}</span>`;
    }

    // Get status text (without HTML)
    function getStatusText(status) {
        const statusMap = {
            'ASSIGNMENT_PHASE': 'Î‘Î½Î¬Î¸ÎµÏƒÎ· ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½',
            'REQUIREMENTS_PHASE': 'Î Î±ÏÎ¿Ï‡Î® Î ÏÎ¿Ï„Î¹Î¼Î®ÏƒÎµÏ‰Î½',
            'EXECUTION_PHASE': 'Î•ÎºÏ„Î­Î»ÎµÏƒÎ·',
            'SOLUTION_FOUND': 'Î•ÏÏÎµÏƒÎ· Î›ÏÏƒÎ·Ï‚',
            'NO_SOLUTION_FOUND': 'ÎœÎ· Î•ÏÏÎµÏƒÎ· Î›ÏÏƒÎ·Ï‚',
            'SOLUTION_APPROVED': 'ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î›ÏÏƒÎ·Ï‚',
            'TERMINATED': 'Î›Î®Î¾Î·'
        };
        return statusMap[status] || status;
    }

    // Load schedules function
    function loadSchedules() {
        if (schedulesTable) {
            schedulesTable.ajax.reload();
        }
    }

     function showAlert(containerId, message, type) {
        const alertContainer = document.getElementById(containerId);
        if (!alertContainer) return;

        const alertClass = {
            'info': 'alert-info',
            'success': 'alert-success',
            'danger': 'alert-danger',
            'warning': 'alert-warning'
        }[type] || 'alert-info';

        const alertId = 'alert-' + Date.now();
        const alertHTML = `
            <div id="${alertId}" class="alert ${alertClass} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;

        alertContainer.insertAdjacentHTML('beforeend', alertHTML);

        // Auto-dismiss after 5 seconds
        setTimeout(() => {
            const alert = document.getElementById(alertId);
            if (alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }
        }, 5000);
    }
</script>
